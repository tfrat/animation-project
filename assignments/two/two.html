<html>
<head>
	<title>Assignment Two: Dynamics</title>
	<style>
	body { margin: 0; }
	canvas { width: 100%; height: 100% }
	</style>
</head>
<body>
	<input type="file" id="fileLoader" style="display:none;" />
	<script src="../../js/three.min.js"></script>
	<script src="../../js/dat.gui.min.js"></script>
	<script src="../../js/animator.js"></script>
	<script>
	var scene = new THREE.Scene()
	var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 )

	// Initialize the renderer
	var renderer = new THREE.WebGLRenderer( { antialias: true })
	renderer.setSize( window.innerWidth, window.innerHeight )
	renderer.shadowMap.enabled = true
	renderer.shadowMap.type = THREE.PCFShadowMap

	// Add the WebGL canvas to browser's window
	var canvas = renderer.domElement
	document.body.appendChild( canvas )

	window.addEventListener( 'resize', onWindowResize, false )
	// Update the canvas and camera when the browser window size is modified
	function onWindowResize(){
		camera.aspect = window.innerWidth / window.innerHeight
		camera.updateProjectionMatrix()

		renderer.setSize( window.innerWidth, window.innerHeight )
	}

	// A cone of light placed directly over the pool table
	var spotLight = new THREE.SpotLight( 0xffffff )
	spotLight.position.set( 0, 100, 0 )

	spotLight.castShadow = true

	spotLight.shadowMapWidth = 1024
	spotLight.shadowMapHeight = 1024

	spotLight.shadowCameraNear = 10
	spotLight.shadowCameraFar = 200
	spotLight.shadowCameraFov = 40

	scene.add( spotLight );

	// Adds a soft white light everywhere in the scene
	var light = new THREE.AmbientLight( 0x404040 );
	scene.add( light );

	// Generate the scene

	/* Sphere */
	var sphereGeometry = new THREE.SphereGeometry( .5, 32, 32 )
	var sphereMaterial = new THREE.MeshPhongMaterial( {
		color: 0x00aaaa,
		specular: 0x222222,
		shininess: 30,
		shading: THREE.SmoothShading
	} )
	var sphere = new THREE.Mesh( sphereGeometry, sphereMaterial )
	sphere.position.set(0, .5, 0)
	sphere.castShadow = true
	sphere.receieveShadow = true
	scene.add( sphere )

	/* Table */
	var tableGeometry = new THREE.PlaneBufferGeometry(8, 4)
	var tableTexture = THREE.ImageUtils.loadTexture('../../textures/pool_table.png')
	tableTexture.wrapS = tableTexture.wrapT = THREE.RepeatWrapping
	tableTexture.repeat.set(16, 16)

	var tableMaterial = new THREE.MeshLambertMaterial( { map: tableTexture} )
	var table = new THREE.Mesh( tableGeometry, tableMaterial)
	table.rotation.set(THREE.Math.degToRad(90), 0, THREE.Math.degToRad(90))
	table.material.side = THREE.DoubleSide
	table.receieveShadow = true
	table.castShadow = false
	scene.add( table )

	// Initialize the camera position
	camera.position.z = 5;
	camera.position.y = 1;
	camera.position.x = 1;

	camera.lookAt( table.position)

	var animation = function (t) {
		sphere.rotation.y = THREE.Math.degToRad(t * 18)
	}

	animate(scene, renderer, -1, animation)

	/* Holds the properties of the object */
	var ObjectProperties = function() {
	  this.x = 0;
		this.y = 0;
		this.z = 0;
	  this.size = 1;
	};

	window.onload = function() {
		var gui = new dat.GUI();
		var text = new ObjectProperties();

		// Handles the spatial values of the object
		var posFolder = gui.addFolder('Position');
		var posX = posFolder.add(text, 'x', -5, 5);
		var posY = posFolder.add(text, 'y', -5, 5);
		var posZ = posFolder.add(text, 'z', -5, 5);
	  var size = gui.add(text, 'size', .1, 10);

		// Listen for values changes and update the object's properties
		posX.onChange(function(value) {
			sphere.position.x = value
		})

		posY.onChange(function(value) {
			sphere.position.y = value
		})

		posZ.onChange(function(value) {
			sphere.position.z = value
		})

		size.onChange(function(value) {
			sphere.scale.set(value, value, value)
		})

		// Sets the foler to be unfolded
		posFolder.open()

	};

	</script>
</body>
</html>
